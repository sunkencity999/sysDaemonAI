/*
    Collection of YARA rules for basic malware detection
*/

rule WindowsExecSuspicious
{
    meta:
        description = "Detects suspicious Windows executable characteristics"
        author = "SysDaemon AI"
        date = "2025-01-01"
        
    strings:
        $sus_import1 = "CreateRemoteThread" ascii wide
        $sus_import2 = "VirtualAlloc" ascii wide
        $sus_import3 = "WriteProcessMemory" ascii wide
        $sus_api1 = "URLDownloadToFile" ascii wide
        $sus_api2 = "ShellExecute" ascii wide
        $pdb_path = /[a-z]:\\.*\.pdb/i
        
    condition:
        uint16(0) == 0x5A4D and // MZ header
        (
            2 of ($sus_import*) or
            any of ($sus_api*) or
            #pdb_path > 0
        )
}

rule Base64EncodedPowershell
{
    meta:
        description = "Detects base64 encoded PowerShell commands"
        author = "SysDaemon AI"
        date = "2025-01-01"
        
    strings:
        $ps = "powershell" nocase
        $enc_param1 = "-e " nocase
        $enc_param2 = "-enc" nocase
        $enc_param3 = "-encodedcommand" nocase
        
    condition:
        $ps and 1 of ($enc_param*)
}

rule SuspiciousScript
{
    meta:
        description = "Detects suspicious script characteristics"
        author = "SysDaemon AI"
        date = "2025-01-01"
        
    strings:
        $eval = "eval(" ascii wide
        $sys_exec1 = "system(" ascii wide
        $sys_exec2 = "shell_exec" ascii wide
        $sys_exec3 = "exec(" ascii wide
        $base64 = "base64_decode" ascii wide
        $wscript = "WScript.Shell" ascii wide
        
    condition:
        any of them
}

rule RansomwareIndicators
{
    meta:
        description = "Detects common ransomware indicators"
        author = "SysDaemon AI"
        date = "2025-01-01"
        
    strings:
        $encrypt_ext1 = ".encrypted" ascii wide
        $encrypt_ext2 = ".locked" ascii wide
        $encrypt_ext3 = ".crypted" ascii wide
        $ransom_note1 = "your files have been encrypted" ascii wide nocase
        $ransom_note2 = "bitcoin" ascii wide nocase
        $ransom_note3 = "decrypt" ascii wide nocase
        
    condition:
        (any of ($encrypt_ext*)) and
        (2 of ($ransom_note*))
}

rule EICARTestFile
{
    meta:
        description = "Detects EICAR test file"
        author = "SysDaemon AI"
        date = "2025-01-01"
        
    strings:
        $eicar = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
        
    condition:
        $eicar
}
